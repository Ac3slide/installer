#!/bin/bash

if [ -f "include/startup.sh" ]; then
    . include/startup.sh
elif [ -f "../include/startup.sh" ]; then
    . ../include/startup.sh
fi

apt install -y update-motd | log
waitOrStop 0

rootDir=$(rootDir)

echo "#!/bin/sh" > /etc/update-motd.d/97-sysinfo

echo "cat << EOF " >> /etc/update-motd.d/97-sysinfo

cat << EOF >> /etc/update-motd.d/97-sysinfo


=== System Info ==============================================================

  CPU: \`grep -c ^processor /proc/cpuinfo\` Cores of\`cat /proc/cpuinfo | grep 'model name' | head -1 | cut -d':' -f2\`
  RAM: \`free -m | head -n 2 | tail -n 1 | awk {'print \$3'}\`MiB / \`free -m | head -n 2 | tail -n 1 | awk {'print \$2'}\`MiB
  Swap Usage: \`free -m | tail -n 1 | awk {'print \$3'}\`MiB / \`free -m | tail -n 1 | awk {'print \$2'}\`MiB
  Disk Usage of /: \`df -h / | awk '{ a = \$3 } END { print a }'\`iB / \`df -h / | awk '{ a = \$2 } END { print a }'\`iB

  \`uptime -p\` since \`uptime -s\`
  \`ps aux --no-heading | wc -l\` running processes
  System load: \`cat /proc/loadavg | awk '{print \$1 ", " \$2 ", " \$3}'\`

EOF
echo "EOF" >> /etc/update-motd.d/97-sysinfo

chmod +x /etc/update-motd.d/97-sysinfo

echo "Adding $rootDir/DESCRIPTION.TXT to /etc/update-motd.d/98-description file" | log

if [ -f "$rootDir/DESCRIPTION.TXT" ];
then

    echo "#!/bin/sh" >> /etc/update-motd.d/98-description
    echo "echo \"=== System Description =======================================================\"" >> /etc/update-motd.d/98-description
    echo "echo \" \""  >> /etc/update-motd.d/98-description
    echo "cat $rootDir/DESCRIPTION.TXT" >> /etc/update-motd.d/98-description
    echo "echo \" \""  >> /etc/update-motd.d/98-description
    echo "echo \"==============================================================================\""  >> /etc/update-motd.d/98-description
    echo "echo \" \""  >> /etc/update-motd.d/98-description
    echo "echo \"To delete this message of the day: rm -rf /etc/update-motd.d/98-description  \""  >> /etc/update-motd.d/98-description

    chmod +x /etc/update-motd.d/98-description

fi

update-motd

exit 0

tagScript success