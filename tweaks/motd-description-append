#!/bin/bash

if [ -f "include/startup.sh" ]; then
    . include/startup.sh
elif [ -f "../include/startup.sh" ]; then
    . ../include/startup.sh
fi

rootDir=$(rootDir)
descriptionMotd=/etc/update-motd.d/98-description

if [ -f "$rootDir/DESCRIPTION.TXT" ]; then

    echo "Adding $rootDir/DESCRIPTION.TXT to $descriptionMotd file" | log

    apt install -y update-motd | log
    waitOrStop 0

    echo "#!/bin/sh" >> $descriptionMotd
    echo "echo \"=== System Description =======================================================\"" >> $descriptionMotd
    echo "echo \" \""  >> $descriptionMotd
    echo "cat $rootDir/DESCRIPTION.TXT" >> $descriptionMotd
    echo "echo \" \""  >> $descriptionMotd
    echo "echo \"==============================================================================\""  >> $descriptionMotd
    echo "echo \" \""  >> $descriptionMotd
    if [ -f "$CWMCONFIGFILE" ]; then
        domainname=`cat $CWMCONFIGFILE | grep url= | awk -F . '{print $2"."$3}'`
        echo "echo \"If you found any issue with this installation or have an idea how to improve this, please email us to: devteam@$domainname, thanks!\"" >> $descriptionMotd
    fi
    echo "echo \" \""  >> $descriptionMotd
    echo "echo \"To delete this message of the day: rm $descriptionMotd  \""  >> $descriptionMotd

    chmod +x $descriptionMotd
    update-motd

    echo "Updating description in CWM backend" | log
    appendServerDescriptionTXT

fi

tagScript success

exit 0