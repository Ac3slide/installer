#!/bin/bash
if [ -f "include/startup.sh" ]; then
    . include/startup.sh
elif [ -f "../include/startup.sh" ]; then
    . ../include/startup.sh
fi

runOnceCheck
checkTagExist apache2.success
checkTagExist php-fpm.success
# checkTagExist php7.2-fpm.success

phpVersion=$(systemctl | grep fpm | awk '{print $1}' | grep -o -P '(?<=php).*(?=-fpm)')
a2enmod proxy_fcgi setenvif
a2enconf php$phpVersion-fpm
sed  -i 's|.*SetHandler.*|SetHandler "proxy:fcgi://localhost:9000/"|'  /etc/apache2/conf-enabled/php$phpVersion-fpm.conf

systemctl restart apache2

# waitOrStop 0

tagScript success

exit 0
