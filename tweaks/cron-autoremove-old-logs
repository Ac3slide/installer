#!/bin/bash

# Add this at the begining of all scripts.
if [ -f "include/startup.sh" ]; then
    . include/startup.sh
elif [ -f "../include/startup.sh" ]; then
    . ../include/startup.sh
fi

runOnceCheck

cronFilename=/etc/cron.daily/installer-autoremove-old-logs

if [ ! -f "$cronFilename" ];
then
    cat <<'EOF' > $cronFilename
#!/bin/bash
availablespace=`df / | awk 'NR==2{print $4}'`
if [ "$availablespace" -lt "2097152" ]; then
        # Find text files and empty them
        find /var/log -type f  | xargs file | grep "ASCII text" | tr ':' ' ' | awk '{ print "echo > "$1}' | sh
        # Find gzipped log files and remove them
        find /var/log -type f  | xargs file | grep "gzip compressed data" | tr ':' ' ' | awk '{ print "rm -rf "$1}' | sh
fi
EOF
chmod +x $cronFilename
fi

tagScript success
