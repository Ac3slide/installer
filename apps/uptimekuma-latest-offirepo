#!/bin/bash

if [ -f "include/startup.sh" ]; then
    . include/startup.sh
elif [ -f "../include/startup.sh" ]; then
    . ../include/startup.sh
fi

rootDir=$(rootDir)

echo "Setting Hostname" | log
hostnamectl set-hostname ${CWM_DOMAIN}

echo "Creating UpTime-Kuma Volume" | log
docker volume create uptime-kuma

echo "Starting UpTime-Kuma container" | log
systemctl restart docker
sleep 5
docker run -d --name uptime-kuma --restart unless-stopped \
	-p 3001:3001 \
	-v /etc/letsencrypt/live/${CWM_DOMAIN}/fullchain.pem:/etc/uptime-kuma/ssl/cert.pem \
	-v /etc/letsencrypt/live/${CWM_DOMAIN}/privkey.pem:/etc/uptime-kuma/ssl/key.pem \
	-v /etc/letsencrypt/live/${CWM_DOMAIN}/chain.pem:/etc/uptime-kuma/ssl/cacerts.pem \
	--privileged -v "uptime-kuma:/app/data" "louislam/uptime-kuma:1"

echo "Enabling Docker Service" | log
systemctl enable docker
sleep 2

echo "Adding descriptions" | log
descriptionAppend "UpTime-Kuma Container: uptime-kuma"
descriptionAppend "Uptime-Kuma web UI: https://${CWM_DOMAIN}:3001"
descriptionAppend " "

tagScript success

exit 0
